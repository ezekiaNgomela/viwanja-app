<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viwanja | Premier Real Estate Dar Es Salaam</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        .glass-nav {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
        }

        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-[#fcfcfc] text-slate-900">
    <div id="header-wrap"></div>

    <header class="bg-white py-10 px-6 max-h-60 border-b border-slate-50 text-center animate__animated animate__fadeIn">
        <div class="max-w-4xl mx-auto">
            <span class="text-blue-600 text-[10px] font-black uppercase tracking-[0.6em] mb-4 block">karibu</span>
            <h2 class="text-5xl md:text-7xl font-black uppercase tracking-tighter text-slate-900 mb-8 leading-none">
                Viwanja Agency & <br><span class="text-slate-300">Modern Housing.</span>
            </h2>
            <p class="text-[11px] font-bold text-slate-400 uppercase tracking-[0.2em] leading-loose max-w-2xl mx-auto">
                Verified listings direct from top-tier agents in Dar Es Salaam. Transparent pricing. Instant WhatsApp
                inquiry.
            </p>
        </div>
    </header>

    <main id="feed-wrap"
        class="max-w-7xl mx-auto py-20 px-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10 min-h-screen">
    </main>

    <div id="footer-wrap"></div>
    <div id="modal-container"></div>

    <script src="js/components.js"></script>
    <script>
        let allPosts = [], currentCat = 'squares';

        async function init() {
            // Render basic layout
            document.getElementById('header-wrap').innerHTML = Components.Header();
            document.getElementById('footer-wrap').innerHTML = Components.Footer();

            // Fetch real data from MongoDB
            try {
                const res = await fetch('/api/properties');
                allPosts = await res.json();
                render();
            } catch (err) {
                console.error("Failed to load listings");
            }
        }

        function setCat(c) {
            currentCat = c;
            // Update button UI
            document.getElementById('btn-squares').className = c === 'squares' ?
                'text-[10px] font-black uppercase tracking-widest text-blue-600' :
                'text-[10px] font-black uppercase tracking-widest text-slate-300';
            document.getElementById('btn-houses').className = c === 'houses' ?
                'text-[10px] font-black uppercase tracking-widest text-blue-600' :
                'text-[10px] font-black uppercase tracking-widest text-slate-300';
            render();
        }

        function render() {
            const container = document.getElementById('feed-wrap');
            const filtered = allPosts.filter(p => p.category === currentCat);

            if (filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-40 opacity-20 font-black uppercase tracking-widest text-xs">No active listings in this category</div>`;
            } else {
                container.innerHTML = filtered.map(p => Components.PropertyCard(p)).join('');
            }
            lucide.createIcons();
        }

        function openModal(id) {
            // Find post by MongoDB _id
            const post = allPosts.find(p => p._id === id);
            if (post) {
                document.getElementById('modal-container').innerHTML = Components.Modal(post);
                lucide.createIcons();
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal() {
            document.getElementById('modal-container').innerHTML = '';
            document.body.style.overflow = 'auto';
        }

        init();
    </script>
</body>


</html>
